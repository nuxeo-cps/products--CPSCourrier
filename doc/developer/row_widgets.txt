===========
Row Widgets
===========

:Revision: $Id$

.. contents:: :depth: 1
.. sectnum::

This is the documentation about the widgets that build up rows in
CPSCourrier's dashboards. Most of them are not designed to be rendered
in any other mode than view.

We'll use a fake DataModel throughout in order not to be bothered in
the examples by the numerous security checks that the full-featured
one provides::

    >>> from Products.CPSSchemas.tests.testWidgets import FakeDataModel

Type Icon Widget
----------------

This widget simply displays the icon associated to the underlying
object portal_type.

Let's instanciate one, with its id::

    >>> from Products.CPSCourrier.widgets.row_widgets \
    ... import CPSTypeIconWidget
    >>> widget = CPSTypeIconWidget('the_widget')
    >>> widget.getId()
    'the_widget'

The prepare method simply puts the object's portal_type in the
dataStructure. To see this, let's make an empty CPSDocument instance, and
related datamodel and datastructures::

    >>> from Products.CPSSchemas.DataModel import DataModel
    >>> from Products.CPSSchemas.DataStructure import DataStructure
    >>> from Products.CPSDocument.CPSDocument import CPSDocument

    >>> doc = CPSDocument('mydoc')
    >>> doc.portal_type = 'Example Document'
    >>> dm = FakeDataModel()
    >>> dm.proxy = doc
    >>> ds = DataStructure(datamodel=dm)

    >>> widget.prepare(ds)
    >>> ds['the_widget']
    'Example Document'

It's the render method's job to query the portal_types tool to get the
icon's file name.

Workflow Variable Widget
------------------------

This widget is a simple helper that fetches the value of a workflow variable
, typically 'review_state' for the proxy or object associated to the
datastructure.

Qualified Link Widget
---------------------

This links reads two or three fields in the datamodel and uses them to
render a detailed <a> tag.

Let's instanciate one, with its id::

    >>> from Products.CPSCourrier.widgets.row_widgets \
    ... import CPSQualifiedLinkWidget
    >>> widget = CPSQualifiedLinkWidget('the_qual')
    >>> widget.getId()
    'the_qual'

Let's make datamodel and datastructure::

    >>> dm = FakeDataModel()
    >>> ds = DataStructure(datamodel=dm)
    >>> dm['text'] = 'text of the link'
    >>> dm['href'] = 'http://target.url'
    >>> dm['title'] = 'title of the link'

Now let's tell the widget on which fields it works and prepare the
datastructure::

    >>> widget.fields = ('text', 'title', 'href',)
    >>> widget.prepare(ds)
    >>> from pprint import PrettyPrinter
    >>> pprint=PrettyPrinter(width=50).pprint
    >>> pprint(ds)
    {'the_qual_title': 'title of the link', 'the_qual_contents': 'text of the link', 'the_qual_href': 'http://target.url'}

This now the result of rendering::

    >>> widget.render('view', ds)
    '<a href="http://target.url" title="title of the link">text of the link</a>'

Optionally, one can provide only two fields. The widget will then fetch the
proxy or object associated to the datamodel and uses its url as target.

List Checkbox Widget
--------------------

This widget renders a checkbox input element, either from the specified field
or from the underlying object's id if there's no associated field.
This latter behaviour is meant for a folder contents type tabular widgets.

The goal is to post a bunch of object identifiers or references as a list.


.. Emacs
.. Local Variables:
.. mode: rst
.. End:
.. Vim
.. vim: set filetype=rst:
