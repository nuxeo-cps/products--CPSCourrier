<tal:comment replace="nothing"> $Id$ </tal:comment>


<script type="text/javascript">
  isChecked = false

  function toggleSelectAll(toggleCheckbox) {
    inputElements = toggleCheckbox.form.getElementsByTagName("input");

    for (i = 0; i < inputElements.length; i++) {
       element = inputElements[i]
       if (element.type == "checkbox") {
           element.checked = ! (isChecked); }
     }
     isChecked = !(isChecked);
   }
</script>

<tal:block define="actions options/actions;
		   batching_info options/batching_info|nothing;
		   here_url options/here_url;
		   make_form python: actions and options['mode'] != 'search'
		   ">
  <tal:block condition="make_form">
    <tal:comment condition="nothing">
      we use "structure string:html_soup" in order to make the ZPT file valid
         xml even if we don't close the form tag now
    </tal:comment>
    <tal:block
	content="structure string:<form action='cpscourrier_batch_perform_form'
					method='post'
					enctype='multipart/form-data'> "/>
  </tal:block>
  <table class="listing"
	 tal:define="columns options/columns;
		     rows options/rows;
		     ">
    <tr>
      <th tal:repeat="col columns">
	<tal:block define="widget python:col[0];
			   is_sort python:col[1];
			   sort_token python:col[2];
			   toggle_get python:col[3];
			   ">

	  <input type="checkbox" name="select_all"
		 onclick="toggleSelectAll(this);"
		 tal:condition="python:widget.meta_type == 'List Checkbox Widget'" />

	  <a href="" tal:omit-tag="not:widget/sortable|nothing"
	     tal:attributes="href string:${here_url}${toggle_get}">
	    <img tal:condition="is_sort" src=""
		  tal:attributes="src python:here_url + test(sort_token,
				   '/arrow_down.png', '/arrow_up.png')" />
	    <tal:block content="widget/label"
		       i18n:translate=""
		       tal:condition="widget/is_i18n" />
	  </a>
	</tal:block>
      </th>
    </tr>
    <tr tal:repeat="row rows"
	  tal:attributes="class python:test(repeat['row'].odd(),
			  'odd', 'even')">
      <tal:block replace="structure row" />
    </tr>
  </table>

  <input type="submit"
	 class="context"
	 tal:repeat="action actions"
         tal:attributes="value action/title;
                         name string:cpscourrier_batch_${action/id}"
	 i18n:attributes="value" />

  <tal:block condition="make_form">
    <tal:block content="structure string:</form>"/>
  </tal:block>

  <tal:batching_gadget condition="batching_info">
    <tal:block define="form_key batching_info/form_key;
		       pages batching_info/linked_pages;
		       current_page batching_info/current_page;
		       ">
      Current page: <span tal:content="current_page"/><br/>
      <a href="" tal:repeat="page pages"
	 tal:attributes="href string:${here_url}?${form_key}=${page};
			 style python:page == current_page and 'strong' or 'small'"
	 tal:content="page"/>
    </tal:block>
  </tal:batching_gadget>

</tal:block>
